import{a as L}from"./chunk-FVFMX3ZS.js";import{$ as A,C as x,F as l,J as a,K as o,L as v,M as f,N as h,O as s,P as w,Q as d,R as b,S as g,_ as I,aa as M,ca as P,da as y,ja as S,ka as k,la as E,ma as F,n as p,o as _,qa as T,ra as V,sa as j,t as u,ta as U,u as r,ua as z,w as C,x as O,xa as R,ya as N}from"./chunk-J7AOECWQ.js";var q=(t,i,e)=>["/viajes-previstos",t,"itinerarios",i,"actividades",e,"archivos","nuevo"],B=(t,i,e,n)=>["/viajes-previstos",t,"itinerarios",i,"actividades",e,"archivos","editar",n];function H(t,i){if(t&1&&(a(0,"h2"),d(1),o()),t&2){let e=s();r(),g("Archivos para la Actividad ",e.actividadId,"")}}function G(t,i){if(t&1){let e=f();a(0,"div",24)(1,"img",25),h("click",function(){p(e);let c=s().$implicit,m=s(2);return _(m.abrirModal(c))}),o()()}if(t&2){let e=s().$implicit,n=s(2);r(),l("src",n.getFileUrl(e),u)("alt",e.descripcion||"Imagen sin descripci\xF3n")}}function Y(t,i){if(t&1){let e=f();a(0,"div",26)(1,"video",27),h("click",function(){p(e);let c=s().$implicit,m=s(2);return _(m.abrirModal(c))}),v(2,"source",28),d(3," Tu navegador no soporta el elemento de video. "),o()()}if(t&2){let e=s().$implicit,n=s(2);r(2),l("src",n.getFileUrl(e),u)("type","video/"+n.getFileExtension(e.nombreArchivo))}}function J(t,i){if(t&1){let e=f();a(0,"div",29)(1,"audio",27),h("click",function(){p(e);let c=s().$implicit,m=s(2);return _(m.abrirModal(c))}),v(2,"source",28),d(3," Tu navegador no soporta el elemento de audio. "),o()()}if(t&2){let e=s().$implicit,n=s(2);r(2),l("src",n.getFileUrl(e),u)("type","audio/"+n.getFileExtension(e.nombreArchivo))}}function K(t,i){if(t&1){let e=f();a(0,"div",11)(1,"div",12),x(2,G,2,2,"div",13)(3,Y,4,2,"div",14)(4,J,4,2,"div",15),o(),a(5,"div",16)(6,"h3"),d(7),o(),a(8,"p")(9,"strong"),d(10,"Tipo:"),o(),d(11),o(),a(12,"p")(13,"strong"),d(14,"Descripci\xF3n:"),o(),d(15),o(),a(16,"p")(17,"strong"),d(18,"Hora de captura:"),o(),d(19),o(),a(20,"p")(21,"strong"),d(22,"Geolocalizaci\xF3n:"),o(),d(23),o(),a(24,"p")(25,"strong"),d(26,"Creaci\xF3n:"),o(),d(27),M(28,"date"),o()(),a(29,"div",17)(30,"button",18),h("click",function(){let c=p(e).$implicit,m=s(2);return _(m.descargarArchivo(c.id))}),v(31,"i",19),o(),a(32,"button",20),h("click",function(){let c=p(e).$implicit,m=s(2);return _(m.eliminarArchivo(c.id))}),v(33,"i",21),o(),a(34,"button",22),v(35,"i",23),o()()()}if(t&2){let e=i.$implicit,n=s(2);r(2),l("ngIf",e.tipo==="foto"||e.tipo==="imagen"),r(),l("ngIf",e.tipo==="video"),r(),l("ngIf",e.tipo==="audio"),r(3),b(e.nombreArchivo),r(4),g(" ",e.tipo,""),r(4),g(" ",e.descripcion||"Sin descripci\xF3n",""),r(4),g(" ",e.horaCaptura||"No especificada",""),r(4),g(" ",e.geolocalizacion||"No disponible",""),r(4),g(" ",P(28,10,e.fechaCreacion,"dd/MM/yyyy"),""),r(7),l("routerLink",A(13,B,n.viajePrevistoId,n.itinerarioId,n.actividadId,e.id))}}function Q(t,i){if(t&1&&(a(0,"div",9),x(1,K,36,18,"div",10),o()),t&2){let e=s();r(),l("ngForOf",e.archivos)}}function W(t,i){t&1&&(a(0,"p",30)(1,"em"),d(2,"No hay archivos registrados para esta actividad."),o()())}function X(t,i){if(t&1&&(a(0,"div"),v(1,"img",36),o()),t&2){let e=s(2);r(),l("src",e.getFileUrl(e.archivoSeleccionado),u)("alt",e.archivoSeleccionado.descripcion)}}function Z(t,i){if(t&1&&(a(0,"div")(1,"video",37),v(2,"source",28),d(3," Tu navegador no soporta el elemento de video. "),o()()),t&2){let e=s(2);r(2),l("src",e.getFileUrl(e.archivoSeleccionado),u)("type","video/"+e.getFileExtension(e.archivoSeleccionado.nombreArchivo))}}function ee(t,i){if(t&1&&(a(0,"div")(1,"audio",37),v(2,"source",28),d(3," Tu navegador no soporta el elemento de audio. "),o()()),t&2){let e=s(2);r(2),l("src",e.getFileUrl(e.archivoSeleccionado),u)("type","audio/"+e.getFileExtension(e.archivoSeleccionado.nombreArchivo))}}function ie(t,i){if(t&1){let e=f();a(0,"div",31),h("click",function(){p(e);let c=s();return _(c.cerrarModal())}),a(1,"div",32),h("click",function(c){return p(e),_(c.stopPropagation())}),a(2,"button",33),h("click",function(){p(e);let c=s();return _(c.cerrarModal())}),v(3,"i",34),o(),x(4,X,2,2,"div",2)(5,Z,4,2,"div",2)(6,ee,4,2,"div",2),a(7,"div",35)(8,"h3"),d(9),o(),a(10,"p")(11,"strong"),d(12,"Descripci\xF3n:"),o(),d(13),o(),a(14,"p")(15,"strong"),d(16,"Fecha:"),o(),d(17),M(18,"date"),o()()()()}if(t&2){let e=s();r(4),l("ngIf",e.archivoSeleccionado.tipo==="foto"||e.archivoSeleccionado.tipo==="imagen"),r(),l("ngIf",e.archivoSeleccionado.tipo==="video"),r(),l("ngIf",e.archivoSeleccionado.tipo==="audio"),r(3),b(e.archivoSeleccionado.nombreArchivo),r(4),g(" ",e.archivoSeleccionado.descripcion||"Sin descripci\xF3n",""),r(4),g(" ",P(18,6,e.archivoSeleccionado.fechaCreacion,"dd/MM/yyyy"),"")}}var $=class t{constructor(i,e,n){this.archivoService=i;this.route=e;this.router=n}archivos=[];actividadId=0;viajePrevistoId=0;itinerarioId=0;archivoSeleccionado=null;ngOnInit(){let i=this.route.snapshot.paramMap;this.viajePrevistoId=Number(i.get("viajePrevistoId"))||0,this.itinerarioId=Number(i.get("itinerarioId"))||0;let e=i.get("actividadId");e?(this.actividadId=Number(e),this.cargarArchivos()):(console.error("actividadId no proporcionado en la ruta"),this.archivos=[])}cargarArchivos(){this.archivoService.getArchivosPorActividad(this.actividadId).subscribe({next:i=>{this.archivos=i??[]},error:i=>{console.error("Error cargando archivos:",i),this.archivos=[]}})}abrirModal(i){this.archivoSeleccionado=i,document.body.style.overflow="hidden"}cerrarModal(){this.archivoSeleccionado=null,document.body.style.overflow="auto"}editarArchivo(i){this.router.navigate(["/viajes-previstos",this.viajePrevistoId,"itinerarios",this.itinerarioId,"actividades",this.actividadId,"archivos","editar",i.id])}getFileUrl(i){if(!i.rutaArchivo)return"";let e=i.rutaArchivo.split(/[\\/]/).pop()||"";return N.production?`/uploads/${e}`:`http://192.168.1.22:3000/uploads/${e}`}getFileExtension(i){return i.split(".").pop()?.toLowerCase()||""}formatDate(i){if(!i)return"Fecha no disponible";let e=new Date(i);return isNaN(e.getTime())?"Fecha inv\xE1lida":e.toLocaleString()}descargarArchivo(i){this.archivoService.descargarArchivo(i).subscribe(e=>{let n=window.URL.createObjectURL(e),c=document.createElement("a"),m=this.archivos.find(D=>D.id===i);c.href=n,c.download=m?.nombreArchivo||"archivo",document.body.appendChild(c),c.click(),window.URL.revokeObjectURL(n),document.body.removeChild(c)})}eliminarArchivo(i){confirm("\xBFEst\xE1s seguro de que quieres eliminar este archivo?")&&this.archivoService.eliminarArchivo(i).subscribe({next:()=>{this.archivos=this.archivos.filter(e=>e.id!==i),this.archivoSeleccionado&&this.archivoSeleccionado.id===i&&this.cerrarModal()},error:e=>{console.error("Error al eliminar archivo:",e),alert("No se pudo eliminar el archivo. Int\xE9ntalo de nuevo.")}})}volverAItinerario(){this.router.navigate(["/viajes-previstos",this.viajePrevistoId,"itinerarios",this.itinerarioId,"actividades"])}static \u0275fac=function(e){return new(e||t)(C(L),C(V),C(U))};static \u0275cmp=O({type:t,selectors:[["app-archivos"]],decls:14,vars:9,consts:[["sinArchivos",""],[1,"contenedor"],[4,"ngIf"],[1,"btn-agregar",3,"routerLink"],[1,"fa","fa-plus-circle"],["class","lista-archivos",4,"ngIf","ngIfElse"],["class","modal-backdrop",3,"click",4,"ngIf"],[1,"btn-volver",3,"click"],[1,"fa","fa-arrow-left"],[1,"lista-archivos"],["class","archivo-item",4,"ngFor","ngForOf"],[1,"archivo-item"],[1,"preview-container"],["class","image-preview",4,"ngIf"],["class","video-preview",4,"ngIf"],["class","audio-preview",4,"ngIf"],[1,"info-archivo"],[1,"acciones"],["title","Descargar",1,"btn-descargar",3,"click"],[1,"fa","fa-download"],["title","Eliminar",1,"btn-eliminar",3,"click"],[1,"fa","fa-trash"],["title","Editar",1,"btn-actualizar",3,"routerLink"],[1,"fa","fa-edit"],[1,"image-preview"],[1,"clickable-media",3,"click","src","alt"],[1,"video-preview"],["controls","",1,"clickable-media",3,"click"],[3,"src","type"],[1,"audio-preview"],[1,"sin-archivos"],[1,"modal-backdrop",3,"click"],[1,"modal-content",3,"click"],[1,"btn-cerrar-modal",3,"click"],[1,"fa","fa-times"],[1,"modal-info"],[3,"src","alt"],["controls","","autoplay",""]],template:function(e,n){if(e&1){let c=f();a(0,"div",1),x(1,H,2,1,"h2",2),a(2,"button",3),v(3,"i",4),d(4," A\xF1adir Archivo "),o(),v(5,"router-outlet")(6,"hr"),x(7,Q,2,1,"div",5)(8,W,3,0,"ng-template",null,0,y)(10,ie,19,9,"div",6),a(11,"button",7),h("click",function(){return p(c),_(n.volverAItinerario())}),v(12,"i",8),d(13," Volver a Itinerario "),o()()}if(e&2){let c=w(9);r(),l("ngIf",n.actividadId),r(),l("routerLink",I(5,q,n.viajePrevistoId,n.itinerarioId,n.actividadId)),r(5),l("ngIf",n.archivos&&n.archivos.length>0)("ngIfElse",c),r(3),l("ngIf",n.archivoSeleccionado)}},dependencies:[F,S,k,E,R,j,z,T],styles:['@charset "UTF-8";.preview-container[_ngcontent-%COMP%]{margin-bottom:1rem}.preview-container[_ngcontent-%COMP%]   img[_ngcontent-%COMP%], .preview-container[_ngcontent-%COMP%]   video[_ngcontent-%COMP%]{max-width:100%;max-height:300px;border-radius:8px;box-shadow:0 2px 8px #0000001a;display:block;margin:0 auto;cursor:pointer;transition:transform .3s ease}.preview-container[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]:hover, .preview-container[_ngcontent-%COMP%]   video[_ngcontent-%COMP%]:hover{transform:scale(1.02);box-shadow:0 4px 12px #00000026}.preview-container[_ngcontent-%COMP%]   audio[_ngcontent-%COMP%]{width:100%;margin:1rem 0;cursor:pointer}.preview-container[_ngcontent-%COMP%]   audio[_ngcontent-%COMP%]:hover{opacity:.9}.archivo-item[_ngcontent-%COMP%]{background:#fff;border-radius:10px;padding:1.5rem;margin-bottom:1.5rem;box-shadow:0 2px 10px #00000014;transition:transform .3s ease,box-shadow .3s ease}.archivo-item[_ngcontent-%COMP%]:hover{transform:translateY(-3px);box-shadow:0 5px 15px #0000001a}.info-archivo[_ngcontent-%COMP%]{margin:1rem 0}.info-archivo[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{color:#3f51b5;margin-top:0;margin-bottom:.5rem}.info-archivo[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:.5rem 0;color:#555}.info-archivo[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{color:#333;font-weight:600}.acciones[_ngcontent-%COMP%]{display:flex;gap:.8rem;justify-content:flex-end}.acciones[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{border:none;background:none;cursor:pointer;font-size:1.2rem;padding:.5rem;border-radius:50%;width:40px;height:40px;display:flex;align-items:center;justify-content:center;transition:all .2s ease}.acciones[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{transform:scale(1.1)}.acciones[_ngcontent-%COMP%]   button.btn-descargar[_ngcontent-%COMP%]{color:#4caf50}.acciones[_ngcontent-%COMP%]   button.btn-descargar[_ngcontent-%COMP%]:hover{background:#4caf501a}.acciones[_ngcontent-%COMP%]   button.btn-eliminar[_ngcontent-%COMP%]{color:#f44336}.acciones[_ngcontent-%COMP%]   button.btn-eliminar[_ngcontent-%COMP%]:hover{background:#f443361a}.acciones[_ngcontent-%COMP%]   button.btn-actualizar[_ngcontent-%COMP%]{color:#ff9800}.acciones[_ngcontent-%COMP%]   button.btn-actualizar[_ngcontent-%COMP%]:hover{background:#ff98001a}.modal-backdrop[_ngcontent-%COMP%]{position:fixed;inset:0;background-color:#000000e6;z-index:1000;display:flex;justify-content:center;align-items:center;opacity:0;animation:_ngcontent-%COMP%_fadeIn .3s ease forwards}.modal-content[_ngcontent-%COMP%]{position:relative;background:#fff;border-radius:12px;max-width:90%;max-height:90vh;width:auto;padding:2rem;box-shadow:0 10px 30px #0000004d;overflow:auto}.modal-content[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{max-height:70vh;max-width:100%;display:block;margin:0 auto;border-radius:6px}.modal-content[_ngcontent-%COMP%]   video[_ngcontent-%COMP%]{max-height:70vh;max-width:100%;display:block;margin:0 auto;border-radius:6px}.modal-content[_ngcontent-%COMP%]   audio[_ngcontent-%COMP%]{width:100%;margin:1rem 0}.btn-cerrar-modal[_ngcontent-%COMP%]{position:absolute;top:15px;right:15px;background:#f5f5f5;border:none;width:40px;height:40px;border-radius:50%;display:flex;align-items:center;justify-content:center;cursor:pointer;font-size:1.2rem;color:#333;transition:all .2s ease;z-index:10}.btn-cerrar-modal[_ngcontent-%COMP%]:hover{background:#e0e0e0;transform:rotate(90deg)}.modal-info[_ngcontent-%COMP%]{margin-top:1.5rem;padding:1rem;background:#f9f9f9;border-radius:8px}.modal-info[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0 0 .5rem;color:#3f51b5}.modal-info[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:.3rem 0;color:#555}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0}to{opacity:1}}@media (max-width: 768px){.modal-content[_ngcontent-%COMP%]{padding:1.5rem;max-width:95%}.modal-content[_ngcontent-%COMP%]   img[_ngcontent-%COMP%], .modal-content[_ngcontent-%COMP%]   video[_ngcontent-%COMP%]{max-height:60vh}.btn-cerrar-modal[_ngcontent-%COMP%]{top:10px;right:10px;width:35px;height:35px}}.sin-archivos[_ngcontent-%COMP%]{text-align:center;color:#666;font-style:italic;padding:2rem;background:#f9f9f9;border-radius:8px;margin:1rem 0}']})};export{$ as ArchivosComponent};
